<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don Arbolito</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #e5e5e5; /* Simula el marco del celular */
        }
        body {
            min-height: 100vh;
            min-width: 100vw;
            width: 100vw;
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #e5e5e5; /* Simula el marco del celular */
        }
        .fade-bg {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 100vh;
            max-width: 430px;
            max-height: 932px;
            min-width: 320px;
            min-height: 568px;
            aspect-ratio: 9/16;
            background: url('Fondo texto.jpg') no-repeat center center;
            background-size: cover;
            opacity: 0;
            transition: opacity 1.2s ease;
            z-index: 1;
            border-radius: 32px;
            box-shadow: 0 0 0 8px #2222, 0 8px 32px #0005;
        }
        .fade-bg.visible {
            opacity: 1;
        }
        .main-content {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            width: 100vw;
            height: 100vh;
            max-width: 430px;
            max-height: 932px;
            min-width: 320px;
            min-height: 568px;
            aspect-ratio: 9/16;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            margin: 0 auto;
            border-radius: 32px;
            box-shadow: 0 0 0 8px #2222, 0 8px 32px #0005;
            background: #fff0;
        }
        .main-content.visible {
            opacity: 1;
            pointer-events: auto;
            transition: opacity 0.7s;
        }
        .arbolito-img {
            width: 60vw;
            max-width: 220px;
            min-width: 120px;
            margin-top: 0;
            opacity: 0;
            transform: translateY(-120px);
            transition: opacity 1.2s, transform 1.2s cubic-bezier(.77,0,.18,1);
            box-shadow: none;
            border-radius: 0;
            background: none;
            display: block;
        }
        .arbolito-img.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .titulo-arbolito {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 2.5rem;
            color: #178a2c;
            font-weight: bold;
            margin-top: 1.2rem;
            margin-bottom: 0.7rem;
            text-align: center;
            text-shadow: 0 2px 12px #fff, 0 0 12px #178a2c, 2px 2px 0 #fff;
        }
        .dialogo-arbolito {
            background: none;
            color: #fff;
            font-family: 'Roboto', Arial, sans-serif;
            font-size: 1.15rem;
            margin-top: 0.5rem;
            margin-bottom: 1.2rem;
            text-align: center;
            text-shadow: 0 2px 8px #000;
            border-radius: 0;
            box-shadow: none;
            padding: 0;
            max-width: 340px;
            border: none;
        }
        .btn-continuar {
            margin-top: 0.5rem;
            font-size: 1.2rem;
            background: #178a2c;
            color: #fff;
            border: 2px solid #fff;
            border-radius: 8px;
            padding: 0.7rem 2.5rem;
            font-weight: bold;
            font-family: 'Montserrat', Arial, sans-serif;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: background 0.2s, border 0.2s;
        }
        .btn-continuar:active {
            background: #176d13;
            border: 2px solid #ffe44d;
        }
        .fade-out {
            opacity: 0 !important;
            pointer-events: none !important;
            transition: opacity 0.8s;
        }
        .pong-bg {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 100vh;
            max-width: 430px;
            max-height: 932px;
            min-width: 320px;
            min-height: 568px;
            aspect-ratio: 9/16;
            background: url('fonde mesa.jpg') no-repeat center center;
            background-size: cover;
            opacity: 0;
            z-index: 10;
            border-radius: 32px;
            box-shadow: 0 0 0 8px #2222, 0 8px 32px #0005;
            transition: opacity 1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pong-bg.visible {
            opacity: 1;
        }
        .pong-container {
            background: #2b4fa2;
            border-radius: 24px;
            box-shadow: 0 4px 24px #0006;
            width: 320px;
            height: 480px;
            max-width: 90vw;
            max-height: 70vh;
            min-width: 220px;
            min-height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        canvas#pong-canvas {
            display: block;
            background: transparent;
            border-radius: 20px;
            width: 100%;
            height: 100%;
        }
        .pong-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 2rem;
            background: rgba(43,79,162,0.95);
            padding: 1.2rem 2.5rem;
            border-radius: 18px;
            box-shadow: 0 2px 12px #0008;
            text-align: center;
            z-index: 2;
            display: none;
        }
        .pong-message.visible {
            display: block;
        }
        @media (max-width: 430px) {
            .main-content, .fade-bg {
                max-width: 100vw;
                max-height: 100vh;
                min-width: 0;
                min-height: 0;
                aspect-ratio: 9/16;
                border-radius: 0;
                box-shadow: none;
            }
            .titulo-arbolito {
                font-size: 2rem;
            }
            .dialogo-arbolito {
                font-size: 1rem;
                padding: 0;
                max-width: 98vw;
            }
            .arbolito-img {
                width: 80vw;
                min-width: 80px;
                max-width: 98vw;
            }
            .pong-container {
                width: 98vw;
                height: 60vw;
                min-width: 180px;
                min-height: 180px;
                max-width: 98vw;
                max-height: 70vw;
            }
        }
    </style>
</head>
<body>
    <div class="fade-bg" id="fade-bg"></div>
    <div class="main-content" id="main-content">
        <img src="DonArbolito.png" class="arbolito-img" id="arbolito-img" alt="Don Arbolito" />
        <div class="titulo-arbolito">Don Arbolito</div>
        <div class="dialogo-arbolito" id="dialogo-arbolito">
            “Estimado caballero, debo confesar que me resulta lamentable negarle la pista sin más...<br>
            pero comprenderá usted que, en su noble búsqueda por el caché, los logros deben ganarse con honor y elegancia.”
        </div>
        <button class="btn-continuar" id="btn-continuar">Continuar</button>
    </div>
    <!-- PONG GAME ELEMENTS -->
    <div class="pong-bg" id="pong-bg" style="display:none;">
        <div class="pong-container">
            <canvas id="pong-canvas" width="320" height="480"></canvas>
            <div class="pong-message" id="pong-message"></div>
        </div>
    </div>
    <!-- DERROTA DIALOGO -->
    <div class="fade-bg" id="lose-fade-bg" style="display:none; z-index:20;"></div>
    <div class="main-content" id="lose-content" style="display:none; z-index:21;">
        <img src="DonArbolito.png" class="arbolito-img visible" alt="Don Arbolito" style="margin-top:0;" />
        <div class="titulo-arbolito">Don Arbolito</div>
        <div class="dialogo-arbolito" id="lose-dialogo">
            Qué desafortunado...
        </div>
        <button class="btn-continuar" id="btn-lose-continuar">Continuar</button>
    </div>
    <script>
        // Paso 1: Fade-in del fondo
        const fadeBg = document.getElementById('fade-bg');
        const mainContent = document.getElementById('main-content');
        const arbolitoImg = document.getElementById('arbolito-img');
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                fadeBg.classList.add('visible');
                // Paso 2: Mostrar main-content después del fade-in del fondo
                setTimeout(() => {
                    mainContent.classList.add('visible');
                    // Paso 3: Animar bajada de DonArbolito.png
                    setTimeout(() => {
                        arbolitoImg.classList.add('visible');
                    }, 400);
                }, 1200);
            }, 100);
        });
        let dialogoStep = 0;
        // Botón continuar (puedes agregar lógica aquí)
        document.getElementById('btn-continuar').onclick = function() {
            const dialogo = document.getElementById('dialogo-arbolito');
            if (dialogoStep === 0) {
                dialogo.innerHTML =
                    '“Aun así, le concederé una ocasión justa.<br>' +
                    'Si logra resistir con dignidad mis embates durante ciclos de quince segundos,<br>' +
                    'y consigue asestar 5 golpes certeros durante los espacios de 3 segundos en los que no muevo la raqueta para defenderme...<br>' +
                    'entonces, y solo entonces, consideraremos este asunto resuelto entre persona-planta decentemente.”';
                dialogoStep = 1;
            } else {
                // Fade out all elements
                fadeBg.classList.add('fade-out');
                mainContent.classList.add('fade-out');
                setTimeout(() => {
                    fadeBg.style.display = 'none';
                    mainContent.style.display = 'none';
                    // Show pong background
                    const pongBg = document.getElementById('pong-bg');
                    pongBg.style.display = 'flex';
                    setTimeout(() => {
                        pongBg.classList.add('visible');
                        startPongGame();
                    }, 50);
                }, 800);
            }
        };

        // --- PONG GAME LOGIC ---
        function startPongGame() {
            const canvas = document.getElementById('pong-canvas');
            const ctx = canvas.getContext('2d');
            const messageDiv = document.getElementById('pong-message');
            // Responsive canvas
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Game variables
            let playerScore = 0, aiScore = 0, gameOver = false;
            let paddleWidth, paddleHeight, ballRadius;
            let playerY, aiY, playerX, aiX, ballX, ballY, ballSpeedX, ballSpeedY;
            let keys = {};
            let animationId;
            let lastTime = null;

            function resetVars() {
                paddleWidth = Math.max(canvas.width * 0.18, 48);
                paddleHeight = Math.max(canvas.height * 0.025, 16);
                ballRadius = Math.max(canvas.width * 0.035, 10);
                playerY = canvas.height - paddleHeight - 10;
                aiY = 10;
                playerX = (canvas.width - paddleWidth) / 2;
                aiX = (canvas.width - paddleWidth) / 2;
                ballX = canvas.width / 2;
                ballY = canvas.height / 2;
                ballSpeedX = 5 * (Math.random() > 0.5 ? 1 : -1);
                ballSpeedY = 5 * (Math.random() > 0.5 ? 1 : -1);
            }
            resetVars();

            window.addEventListener('resize', () => {
                resetVars();
            });

            // Control: mouse/touch or keyboard
            function movePlayerTo(x) {
                playerX = Math.max(0, Math.min(canvas.width - paddleWidth, x - paddleWidth / 2));
            }
            canvas.addEventListener('mousemove', e => {
                const rect = canvas.getBoundingClientRect();
                movePlayerTo(e.clientX - rect.left);
            });
            canvas.addEventListener('touchmove', e => {
                if (e.touches.length > 0) {
                    const rect = canvas.getBoundingClientRect();
                    movePlayerTo(e.touches[0].clientX - rect.left);
                }
            });
            document.addEventListener('keydown', e => {
                keys[e.key] = true;
            });
            document.addEventListener('keyup', e => {
                keys[e.key] = false;
            });

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Middle line
                ctx.strokeStyle = "#fff8";
                ctx.setLineDash([8, 8]);
                ctx.beginPath();
                ctx.moveTo(canvas.width/2, 0);
                ctx.lineTo(canvas.width/2, canvas.height);
                ctx.stroke();
                ctx.setLineDash([]);
                // Paddles
                ctx.fillStyle = "#fff";
                ctx.fillRect(playerX, playerY, paddleWidth, paddleHeight);
                ctx.fillRect(aiX, aiY, paddleWidth, paddleHeight);
                // Ball
                ctx.beginPath();
                ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
                ctx.fillStyle = "#ffe44d";
                ctx.shadowColor = "#ffe44d";
                ctx.shadowBlur = 8;
                ctx.fill();
                ctx.shadowBlur = 0;
                // Scores
                ctx.font = `bold ${Math.floor(canvas.height/12)}px Montserrat, Arial, sans-serif`;
                ctx.fillStyle = "#fff";
                ctx.textAlign = "center";
                ctx.fillText(playerScore, canvas.width/2, canvas.height*0.7);
                ctx.fillText(aiScore, canvas.width/2, canvas.height*0.3);
            }

            function update(dt) {
                // Keyboard control
                let moveSpeed = Math.max(canvas.width * 0.7, 220); // px/sec
                if (keys['ArrowLeft'] || keys['a']) playerX -= moveSpeed * dt;
                if (keys['ArrowRight'] || keys['d']) playerX += moveSpeed * dt;
                playerX = Math.max(0, Math.min(canvas.width - paddleWidth, playerX));

                // AI movement (smooth interpolation)
                const aiCenter = aiX + paddleWidth/2;
                let aiTarget = ballX - paddleWidth/2;
                let aiSpeed = Math.max(canvas.width * 0.55, 180); // px/sec
                aiX += (aiTarget - aiX) * Math.min(1, aiSpeed * dt / Math.abs(aiTarget - aiX + 0.01));
                aiX = Math.max(0, Math.min(canvas.width - paddleWidth, aiX));

                // Ball movement
                ballX += ballSpeedX * dt * 60;
                ballY += ballSpeedY * dt * 60;

                // Wall collision
                if (ballX - ballRadius < 0) {
                    ballX = ballRadius;
                    ballSpeedX *= -1;
                }
                if (ballX + ballRadius > canvas.width) {
                    ballX = canvas.width - ballRadius;
                    ballSpeedX *= -1;
                }

                // Player paddle collision
                if (
                    ballY + ballRadius >= playerY &&
                    ballX > playerX && ballX < playerX + paddleWidth &&
                    ballSpeedY > 0
                ) {
                    ballY = playerY - ballRadius;
                    ballSpeedY *= -1;
                    // Add some effect based on where it hits
                    let hit = (ballX - (playerX + paddleWidth/2)) / (paddleWidth/2);
                    ballSpeedX += hit * 3;
                    // Clamp speed
                    ballSpeedX = Math.max(-9, Math.min(9, ballSpeedX));
                    // Aumenta levemente la velocidad de la bola
                    ballSpeedY *= 1.04;
                }
                // AI paddle collision
                if (
                    ballY - ballRadius <= aiY + paddleHeight &&
                    ballX > aiX && ballX < aiX + paddleWidth &&
                    ballSpeedY < 0
                ) {
                    ballY = aiY + paddleHeight + ballRadius;
                    ballSpeedY *= -1;
                    let hit = (ballX - (aiX + paddleWidth/2)) / (paddleWidth/2);
                    ballSpeedX += hit * 3;
                    ballSpeedX = Math.max(-9, Math.min(9, ballSpeedX));
                    ballSpeedY *= 1.04;
                }

                // Score
                if (ballY - ballRadius < 0) {
                    playerScore++;
                    resetBall(-1);
                }
                if (ballY + ballRadius > canvas.height) {
                    aiScore++;
                    resetBall(1);
                }
            }

            function resetBall(dir) {
                ballX = canvas.width / 2;
                ballY = canvas.height / 2;
                ballSpeedX = 5 * (Math.random() > 0.5 ? 1 : -1);
                ballSpeedY = 5 * dir;
            }

            function loop(now) {
                if (gameOver) return;
                if (!lastTime) lastTime = now;
                let dt = Math.min((now - lastTime) / 1000, 0.035); // max 35ms/frame
                lastTime = now;
                update(dt);
                draw();
                if (playerScore >= 5 || aiScore >= 5) {
                    gameOver = true;
                    showEndMessage();
                    return;
                }
                animationId = requestAnimationFrame(loop);
            }

            function showEndMessage() {
                if (playerScore >= 5) {
                    messageDiv.textContent = "¡Ganaste!";
                    messageDiv.classList.add('visible');
                } else {
                    // Fade out pong and show lose dialog
                    const pongBg = document.getElementById('pong-bg');
                    pongBg.classList.remove('visible');
                    setTimeout(() => {
                        pongBg.style.display = 'none';
                        showLoseDialog();
                    }, 800);
                }
            }

            // Start game
            playerScore = 0; aiScore = 0; gameOver = false;
            messageDiv.classList.remove('visible');
            lastTime = null;
            resetVars();
            requestAnimationFrame(loop);
        }

        function showLoseDialog() {
            // Fade in Fondo texto.jpg y dialogo
            const loseFadeBg = document.getElementById('lose-fade-bg');
            const loseContent = document.getElementById('lose-content');
            // Set Fondo texto.jpg como fondo
            loseFadeBg.style.background = "url('Fondo texto.jpg') no-repeat center center";
            loseFadeBg.style.backgroundSize = "cover";
            loseFadeBg.style.display = 'block';
            loseContent.style.display = 'flex';
            setTimeout(() => {
                loseFadeBg.classList.add('visible');
                loseContent.classList.add('visible');
            }, 30);
            // Botón continuar
            document.getElementById('btn-lose-continuar').onclick = function() {
                // Fade out lose dialog
                loseFadeBg.classList.remove('visible');
                loseContent.classList.remove('visible');
                setTimeout(() => {
                    window.location.href = "https://danjua77.github.io/Sagrado.Puzzle/";
                }, 700);
            };
        }
    </script>
</body>
</html>
